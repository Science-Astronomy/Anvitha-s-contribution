<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FlightTracker ‚Ä¢ Carbon Impact Monitor</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg: #f1f8f4;
      --panel: #ffffff;
      --ink: #0f172a;
      --muted: #64748b;
      --line: #e2e8f0;
      --blue: #2563eb;
      --red: #ef4444;
      --purple: #7c3aed;
      --green: #16a34a;
      --shadow: 0 10px 20px rgba(2, 6, 23, 0.06),
        0 2px 6px rgba(2, 6, 23, 0.04);
    }
    body { margin: 0; font-family: Inter, system-ui, sans-serif; color: var(--ink); background: var(--bg); display: flex; height: 100%; }
    .sidebar { width: 250px; min-height: 100vh; background: #fff; border-right: 1px solid var(--line); display: flex; flex-direction: column; justify-content: space-between; padding: 18px 14px; }
    .main { flex: 1; padding: 24px; overflow: auto; }
    .brand { display: flex; gap: 12px; align-items: center; }
    .brand-icon { width: 40px; height: 40px; display: grid; place-items: center; background: #e6f6ea; border-radius: 12px; }
    .brand-title { font-weight: 700; }
    .brand-sub { font-size: 0.85rem; color: var(--muted); }
    .nav { display: flex; flex-direction: column; gap: 8px; margin-top: 18px; }
    .nav-item, .btn { cursor: pointer; border: none; border-radius: 12px; padding: 10px 12px; font-weight: 600; }
    .nav-item { display: flex; gap: 10px; text-decoration: none; color: var(--ink); }
    .nav-item.active { background: #e8fff0; color: #166534; }
    .btn-ghost { background: #eef2ff; color: #4338ca; }
    .sidebar-cta { margin-top: auto; display: grid; gap: 8px; place-items: center; padding: 14px; border: 1px dashed #94a3b8; border-radius: 14px; background: #ecfdf5; }
    .page-header h1 { margin: 0 0 4px; font-size: 2rem; color: #166534; }

    .kpi-grid { margin-top: 18px; display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; }
    .kpi { background: var(--panel); border-radius: 18px; padding: 14px; box-shadow: var(--shadow); }
    .kpi-value { font-size: 28px; font-weight: 700; color: #fff; }
    .kpi-blue { background: linear-gradient(135deg, #1d4ed8, #60a5fa); }
    .kpi-red { background: linear-gradient(135deg, #dc2626, #fb7185); }
    .kpi-purple { background: linear-gradient(135deg, #7c3aed, #a78bfa); }
    .kpi-green { background: linear-gradient(135deg, #16a34a, #34d399); }

    .content-grid { margin-top: 18px; display: grid; grid-template-columns: 2fr 1fr; gap: 18px; }
    .card { background: var(--panel); border: 1px solid var(--line); border-radius: 16px; box-shadow: var(--shadow); padding: 16px; }

    .flight-list { list-style: none; padding: 0; margin: 0; display: grid; gap: 12px; }
    .flight { display: grid; grid-template-columns: auto 1fr auto; gap: 10px; align-items: center; padding: 12px; border: 1px solid var(--line); border-radius: 14px; background: #f8fafc; }
    .badge { font-size: 0.75rem; padding: 2px 8px; border-radius: 999px; background: #e2e8f0; }
    .tag { font-size: 0.7rem; padding: 2px 8px; border-radius: 999px; background: #ecfeff; color: #0891b2; margin-left: 6px; }
    .dim { color: var(--muted); }
    .hidden { display: none; }

    .form-grid { display: grid; gap: 12px; }
    .form-grid input, .form-grid select { padding: 8px; border: 1px solid var(--line); border-radius: 8px; }
    .btn-green { background: linear-gradient(135deg, #16a34a, #34d399); color: #fff; }

    .persp-box { display: grid; grid-template-columns: auto 1fr auto; gap: 12px; align-items: center; background: #f0fdf4; padding: 12px; border-radius: 12px; }
    .persp-box div:last-child { font-weight: 700; color: #14532d; }

    .impact-card { background: linear-gradient(135deg,#16a34a,#60d394); color:#052e16; border:none; margin-top:12px;}
    .impact-title{display:flex;align-items:center;gap:8px;font-weight:700}
    .impact-grid{margin-top:8px;display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    .impact-item{background:rgba(255,255,255,.25);border-radius:12px;padding:12px}
    .impact-value{font-size:22px;font-weight:800}
    .impact-label{font-size:12px;opacity:.9}
  </style>
</head>
<body>
  <!-- Sidebar -->
  <aside class="sidebar">
    <div>
      <div class="brand">
        <div class="brand-icon">‚úàÔ∏è</div>
        <div>
          <div class="brand-title">FlightTracker</div>
          <div class="brand-sub">Carbon Impact Monitor</div>
        </div>
      </div>
      <nav class="nav">
        <a id="dashboardLink" class="nav-item active" href="#">Dashboard</a>
        <button id="addFlightBtn" class="btn btn-ghost">Ôºã Add Flight</button>
      </nav>
    </div>
    <div class="sidebar-cta">üå± Reduce Your Carbon Footprint</div>
  </aside>

  <!-- Main -->
  <main class="main">
    <!-- Dashboard -->
    <section id="dashboardSection">
      <header class="page-header"><h1>Flight Dashboard</h1></header>
      <section class="kpi-grid">
        <div class="kpi kpi-blue"><div class="kpi-value" id="kpiFlights">0</div><div>Total Flights</div></div>
        <div class="kpi kpi-red"><div class="kpi-value" id="kpiCO2">0 kg</div><div>Total CO‚ÇÇ</div></div>
        <div class="kpi kpi-purple"><div class="kpi-value" id="kpiKm">0 km</div><div>Distance</div></div>
        <div class="kpi kpi-green"><div class="kpi-value" id="kpiTrees">0</div><div>Trees</div></div>
      </section>
      <section class="content-grid">
        <div class="card"><canvas id="co2Chart"></canvas></div>
        <div class="card"><div class="card-title">Recent Flights</div><ul id="recentFlights" class="flight-list"></ul></div>
      </section>
    </section>
    <!-- Add Flight -->
    <section id="addFlightSection" class="hidden">
      <header class="page-header"><h1>Add New Flight</h1></header>
      <section class="content-grid">
        <div class="card">
          <form id="addFlightForm" class="form-grid">
            <label>From 
              <input type="text" name="from" placeholder="IATA/ICAO or @lat,lon" required />
            </label>
            <label>To 
              <input type="text" name="to" placeholder="IATA/ICAO or @lat,lon" required />
            </label>
            <label>Date <input type="date" name="date" required /></label>
            <label>Airline <input type="text" name="airline" /></label>
            <label>Code <input type="text" name="code" /></label>
            <label>Aircraft
              <select name="aircraft">
                <option value="narrow">Narrow</option>
                <option value="wide">Wide</option>
              </select>
            </label>
            <label>Cabin
              <select name="cabin">
                <option value="economy">Economy</option>
                <option value="business">Business</option>
                <option value="first">First</option>
              </select>
            </label>
            <button type="submit" class="btn-green">Add Flight</button>
          </form>
        </div>

        <div class="card">
          <div>üìä Emission Estimate</div>
          <p id="estimateCO2">0 kg</p>
          <p id="estimateMeta">Distance: 0 km ‚Ä¢ Trees: 0</p>
        </div>

        <div class="card">
          <div>Put It In Perspective</div>
          <div class="persp-box"> üöó <div>Car equivalent</div><div><span id="perspCar">0</span> km</div></div>
          <div class="persp-box"> üå≤ <div>Trees needed</div><div><span id="perspTrees">0</span></div></div>
          <div class="persp-box"> üè† <div>Home energy</div><div><span id="perspEnergy">0</span> months</div></div>
        </div>

        <!-- üå≤ New Environmental Impact card -->
        <div class="card impact-card">
          <div class="impact-title">üå≤ Environmental Impact</div>
          <div class="impact-grid">
            <div class="impact-item"><div class="impact-value" id="impactTotalCo2">0</div><div class="impact-label">kg CO‚ÇÇ</div></div>
            <div class="impact-item"><div class="impact-value" id="impactTrees">0</div><div class="impact-label">trees</div></div>
            <div class="impact-item"><div class="impact-value" id="impactAvg">0</div><div class="impact-label">avg/flight</div></div>
          </div>
          <div class="hint" id="impactHint">Includes saved flights.</div>
        </div>
      </section>
    </section>
  </main>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script>
    // ===== Airport DB =====
    let IATA_MAP=new Map(), ICAO_MAP=new Map(), CITY_MAP = new Map();

    async function loadAirports(){
      try{
        const resp = await fetch("https://cdn.jsdelivr.net/gh/mwgg/Airports/airports.json");
        const data = await resp.json();
        for(const icao in data){
          const r = data[icao];
          const lat = +r.lat, lon = +r.lon;
          if(!Number.isFinite(lat) || !Number.isFinite(lon)) continue;

          ICAO_MAP.set(icao.toUpperCase(), [lat,lon]);
          if(r.iata) IATA_MAP.set(r.iata.toUpperCase(), [lat,lon]);
          if(r.city){ CITY_MAP.set(r.city.toUpperCase(), [lat,lon]); }
        }
      }catch(e){ console.error("Airport DB load failed", e); }
    }
    loadAirports();
    
    function lookupAirport(p){
      if(!p) return null;
      p = p.trim().toUpperCase();
      if(p.startsWith("@")){ const [la,lo] = p.slice(1).split(","); return [parseFloat(la), parseFloat(lo)]; }
      if(CITY_MAP.has(p)) return CITY_MAP.get(p);
      if(IATA_MAP.has(p)) return IATA_MAP.get(p);
      if(ICAO_MAP.has(p)) return ICAO_MAP.get(p);
      return null;
    }

    const R=6371,toRad=d=>d*Math.PI/180;
    const haversine=(a,b)=>2*R*Math.asin(Math.sqrt(Math.sin((toRad(b[0]-a[0]))/2)**2+Math.cos(toRad(a[0]))*Math.cos(toRad(b[0]))*Math.sin((toRad(b[1]-a[1]))/2)**2));

    // ===== Demo flights =====
    const recent=[
      { airline:"British Airways", code:"BA112", from:"New York", to:"London", when:"Dec 14, 2024", km:5585, cabin:"economy", co2kg:1089, type:"long haul" },
      { airline:"Air France", code:"AF1234", from:"Paris", to:"Madrid", when:"Nov 30, 2024", km:1050, cabin:"economy", co2kg:210, type:"short haul" },
      { airline:"United Airlines", code:"UA415", from:"San Francisco", to:"Seattle", when:"Nov 22, 2024", km:1091, cabin:"economy", co2kg:196, type:"short haul" }
    ];
    const monthly={labels:["Sep 2024","Oct 2024","Nov 2024","Dec 2024"],co2kg:[900,2100,4800,1300]};
    const sum=a=>a.reduce((x,y)=>x+y,0);

    function renderKpis(){
      document.getElementById("kpiFlights").textContent=recent.length;
      document.getElementById("kpiCO2").textContent=sum(recent.map(r=>r.co2kg))+" kg";
      document.getElementById("kpiKm").textContent=sum(recent.map(r=>r.km))+" km";
      document.getElementById("kpiTrees").textContent=Math.round(sum(recent.map(r=>r.co2kg))/22);
    }
    function renderList(){
      const ul=document.getElementById("recentFlights"); ul.innerHTML="";
      recent.forEach(r=>ul.innerHTML+=`<li class="flight">
        <div>‚úàÔ∏è</div>
        <div>
          <div><strong>${r.airline}</strong> <span class="badge">${r.code}</span> <span class="tag">${r.cabin}</span></div>
          <div class="dim">${r.from} ‚Üí ${r.to} ‚Ä¢ ${r.when}</div>
          <div class="dim">${r.km} km ‚Ä¢ ${r.type}</div>
        </div>
        <div><div class="badge">${r.co2kg} kg CO‚ÇÇ</div></div>
      </li>`);
    }
    new Chart(document.getElementById("co2Chart"),{
      type:"bar",
      data:{labels:monthly.labels,datasets:[{label:"CO‚ÇÇ (kg)",data:monthly.co2kg,borderRadius:10}]},
      options:{plugins:{legend:{display:false}}}
    });

    // ===== Navigation =====
    const dash=document.getElementById("dashboardSection"), add=document.getElementById("addFlightSection");
    document.getElementById("addFlightBtn").onclick=()=>{dash.classList.add("hidden");add.classList.remove("hidden");};
    document.getElementById("dashboardLink").onclick=e=>{e.preventDefault();add.classList.add("hidden");dash.classList.remove("hidden");};

    // ===== Form + estimates =====
    const form=document.getElementById("addFlightForm");
    
    function computeKm(){
      const a = lookupAirport(form.from.value), b = lookupAirport(form.to.value);
      if(!a || !b) return 0;
      return Math.round(haversine(a,b));
    }

    function estimate(){
      const km=computeKm(), cabin=form.cabin.value, ac=form.aircraft.value;
      let f=0.18;
      if(ac==="wide") f*=1.05;
      if(cabin==="business") f*=2;
      if(cabin==="first") f*=3;
      const co2=Math.round(km*f), trees=Math.round(co2/22);
      document.getElementById("estimateCO2").textContent=`${co2} kg`;
      document.getElementById("estimateMeta").textContent=`Distance: ${km} km ‚Ä¢ Trees: ${trees}`;
      document.getElementById("perspCar").textContent=Math.round(co2/0.12);
      document.getElementById("perspTrees").textContent=trees;
      document.getElementById("perspEnergy").textContent=Math.round(co2/300);
      updateImpact(true,co2);
      return {km,co2};
    }

    function resetEstimateUI(){
      document.getElementById("estimateCO2").textContent="0 kg";
      document.getElementById("estimateMeta").textContent="Distance: 0 km ‚Ä¢ Trees: 0";
      document.getElementById("perspCar").textContent="0";
      document.getElementById("perspTrees").textContent="0";
      document.getElementById("perspEnergy").textContent="0";
      updateImpact(false);
    }

    function updateImpact(preview=false,current=0){
      const totalSaved=sum(recent.map(r=>r.co2kg)), flights=recent.length;
      const total=preview?totalSaved+current:totalSaved;
      const f=preview?(flights+(current>0?1:0)):flights;
      document.getElementById("impactTotalCo2").textContent=total;
      document.getElementById("impactTrees").textContent=Math.round(total/22);
      document.getElementById("impactAvg").textContent=f?Math.round(total/f):0;
      document.getElementById("impactHint").textContent=preview?"Includes saved flights + this entry.":"Includes saved flights.";
    }

    ["input","change"].forEach(ev=>["from","to","cabin","aircraft"].forEach(n=>form[n].addEventListener(ev,estimate)));

    form.onsubmit=e=>{
      e.preventDefault();
      const {km,co2}=estimate();
      if(!km) return;
      recent.unshift({
        airline: form.airline.value||"Airline",
        code: (form.code.value||"NEW").toUpperCase(),
        from: form.from.value, to: form.to.value,
        when: new Date(form.date.value).toLocaleDateString(),
        km, co2kg: co2, cabin: form.cabin.value,
        type: km>3500?"long haul":"short haul"
      });
      renderKpis(); renderList(); updateImpact(false);
      dash.classList.remove("hidden"); add.classList.add("hidden");
      form.reset(); resetEstimateUI(); // reset preview to 0s
    };

    // ===== Init =====
    renderKpis(); renderList(); estimate(); updateImpact(false);
  </script>
</body>
</html>


